#!/usr/bin/env ruby

require 'optparse'
require 'nwn/all'

$backtrace = false
OptionParser.new do |o|
  o.banner = "Usage: nwn-dsl [options] <script> -- [arguments to script]"
  o.on "-b", "--backtrace", "Show a backtrace on error" do
    $backtrace = true
  end
end.parse!

fail "Not enough arguments (try -h)." unless ARGV.size > 0

$base_script = ARGV.shift

begin
  NWN::Gff::Scripting.run_script(IO.read($base_script), nil, ARGV)
rescue => e
  message = e.message.split(':', 4)[3].strip
  $stderr.puts message
  if $backtrace
    $stderr.puts ""
    $stderr.puts "  " + e.backtrace.join("\n")
  end
  exit 1
end
